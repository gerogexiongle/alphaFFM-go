# 负数特征处理说明

## 问题说明

在真实数据中发现了负数特征，例如：`-104:1`, `-110:1`, `-117:1` 等。

这些负数特征可能是：
- 缺失值标记
- 特殊编码
- 占位符

## 解决方案

### 自动处理规则

系统现在智能处理三种特征类型：

1. **大数字特征** (>= 1000000)
   - 自动提取高32位作为域ID
   - 例如: `51539607578` → `field_12`

2. **负数特征**
   - 自动分配到 `special` 域
   - 例如: `-104`, `-110`, `-117` → `special`

3. **小特征** (0-999999)
   - 需要配置文件
   - 例如: `sex`, `age`, `64` → 需要配置

## 实际示例

### 真实数据

```
86059384 1720212991_1763784954 1 51539607579:1 55834574867:1 -104:1 38654705667:1
```

### 转换后

```
1 51539607579:1 55834574867:1 -104:1 38654705667:1
```

### 处理结果

```
FIELDS field_1 field_2 field_9 special
```

说明：
- `51539607579` → `field_12` (高32位=12)
- `55834574867` → `field_13` (高32位=13)  
- `38654705667` → `field_9` (高32位=9)
- `-104` → `special` (负数特征)

## 统计信息

在测试数据中发现的负数特征：

```
-104
-110
-114
-116
-117
-118
-120
-29
-64
-69
-76
-87
```

共12个负数特征，全部自动分配到 `special` 域。

## 使用方法

### 无需任何修改！

直接使用 `benchmark_ffm_vs_fm.sh` 即可：

```bash
sh benchmark_ffm_vs_fm.sh
```

系统会自动处理：
- ✅ 大数字特征 → 自动提取域ID
- ✅ 负数特征 → `special` 域
- ✅ 无需配置文件

## 代码逻辑

```go
if strings.HasPrefix(feature, "-") {
    // 负数特征自动分配到 "special" 域
    field = "special"
} else if numFeature >= 1000000 {
    // 大数字特征，自动提取高32位
    fieldID := uint32(numFeature >> 32)
    field = fmt.Sprintf("field_%d", fieldID)
} else {
    // 小特征，需要配置文件
    // ...
}
```

## 自定义负数域名

如果您想将负数特征映射到不同的域，可以修改代码中的 `"special"` 为其他名称，例如：
- `"missing"` - 表示缺失值
- `"sparse"` - 表示稀疏特征
- `"indicator"` - 表示指示器

或者使用配置文件显式指定每个负数特征的域。

## 总结

### 三种特征，自动处理

| 特征类型 | 示例 | 处理方式 | 域名 |
|---------|------|---------|------|
| 大数字 | 51539607578 | 自动提取高32位 | field_12 |
| 负数 | -104 | 自动分配 | special |
| 小数字/字符串 | sex, 64 | 需要配置文件 | 配置指定 |

### ✅ 您的数据完美支持

- 大数字特征 ✅ 自动处理
- 负数特征 ✅ 自动处理  
- 无需配置文件 ✅
- 直接运行 benchmark ✅

问题解决！🎉

